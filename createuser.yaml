---
- name: Create user with sudo privileges on localhost
  hosts: localhost
  become: yes
  tasks:
    - name: Create the new user account with a password
      ansible.builtin.user:
        name: ansible_user
        comment: "User with sudo (root) access"
        shell: /bin/bash
        password: "$2b$10$MZxPwd3sPvxwmWBAt.j9LO3emIED94TU1iz2gSMd.6pbkjGwifuH2"
        create_home: yes

    - name: Configure passwordless sudo for the user
      ansible.builtin.copy:
        dest: /etc/sudoers.d/ansibleuser
        content: "ansibleuser ALL=(ALL) NOPASSWD:ALL\n"
        owner: root
        group: root
        mode: '0440'
